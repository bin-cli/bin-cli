#!/usr/bin/env bash
set -euo pipefail
cd "$(dirname "$0")/../.."

version=${1-1.2.3}

mkdir -p temp/dist
cp src/pandoc-man.css temp/dist/pandoc-man.css

for page in src/*.md; do
    page=$(basename "$page" .md)

    sed -E "s/\\\$VERSION/$version/g" "src/$page.md" |
        # Clearing the 'title' var so no <h1> is generated but <title> is still set
        # Extensions are the same as below
        pandoc \
            --standalone \
            --from markdown+hard_line_breaks-raw_html-smart \
            --to html \
            --css 'pandoc-man.css' \
            --variable title='' \
        > "temp/dist/$page.html"
done
